id: ddhi_ingest_level_1
migration_group: 'DDHI'
label: 'DDHI Ingest Level 1'
migration_tags: null
migration_group: null
source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: xml
  constants:
    PLACE_NAME_ELEMENT: 'placeName'
    PERSON_NAME_ELEMENT: 'persName'
    ORG_NAME_ELEMENT: 'orgName'
    EVENT_ELEMENT: 'rs[@type="event"]'
    NAMED_ENTITITES_ELEMENT: 'name' 
    DATE_ELEMENT: 'date'
  namespaces:
    tei: "http://www.tei-c.org/ns/1.0"
  urls: 
    - public://ingest_test/lovely.tei.xml
  item_selector: /TEI
  fields:
    - 
      name: title
      label: Title
      selector: tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title
    - 
      name: body
      label: Transcription
      selector: tei:text/tei:body
  # Under 'ids', we identify source fields populated above which will uniquely
  # identify each imported item. The 'type' makes sure the migration map table
  # uses the proper schema type for stored the IDs.
  ids:
    title:
      type: string
process:
  title: title
  'body/format':
    plugin: default_value
    default_value: full_html
  'body/value': 
    plugin: ddhi_ingest_body
    source: body
  # Plugin expects an array with an element name to extract and the source row
  field_entities_places:
      plugin: extract_named_entities
      source: 
        - constants/PLACE_NAME_ELEMENT
        - body
  field_entities_persons:
      plugin: extract_named_entities
      source: 
        - constants/PERSON_NAME_ELEMENT
        - body
  field_entities_organizations:
      plugin: extract_named_entities
      source: 
        - constants/ORG_NAME_ELEMENT
        - body
  field_entities_events:
      plugin: extract_named_entities
      source: 
        - constants/EVENT_ELEMENT
        - body
  field_entities_named:
      plugin: extract_named_entities
      source: 
        - constants/NAMED_ENTITITES_ELEMENT
        - body
  # Will likely need its own plugin
  field_entities_dates:
      plugin: extract_named_entities
      source: 
        - constants/DATE_ELEMENT
        - body
destination:
  plugin: entity:node
  default_bundle: transcript
dependencies:
  enforced:
    module:
      - ddhi_ingest
