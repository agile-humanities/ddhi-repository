id: ddhi_ingest_level_1
migration_group: 'DDHI'
label: 'DDHI Ingest Level 1'
migration_tags: null
migration_group: null
source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: xml
  namespaces:
    tei: "http://www.tei-c.org/ns/1.0"
  urls: 
    - public://ingest_test/lovely.tei.xml
  item_selector: /TEI
  fields:
    - 
      name: title
      label: Title
      selector: tei:teiHeader/tei:fileDesc/tei:titleStmt/tei:title
    - 
      name: body
      label: Transcription
      selector: tei:text/tei:body
    -
      name: placenames
      label: "Place Names"
      selector: tei:text/tei:body//tei:placeName
  # Under 'ids', we identify source fields populated above which will uniquely
  # identify each imported item. The 'type' makes sure the migration map table
  # uses the proper schema type for stored the IDs.
  ids:
    title:
      type: string
process:
  title: title
  'body/format':
    plugin: default_value
    default_value: full_html
  'body/value': 
    plugin: ddhi_ingest_body
    source: body
  field_entities_places:
    # -
    #  plugin: callback
    #  callable: var_export
    #  source: placenames
    # -
    #  plugin: callback
    #  callable: strlen
    #  source: placenames
    -
      plugin: extract_named_entities
      source: body
destination:
  plugin: entity:node
  default_bundle: transcript